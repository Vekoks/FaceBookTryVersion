@model MeetLifeClient.Models.UserPicturesModel

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Pictures</title>
</head>
<body>
    <div>
        @if (User.Identity.Name.Contains(Model.UserName))
        {
            using (Html.BeginForm("PicturesSave", "DetaialUser", FormMethod.Post, new { @enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary("", new { @class = "text-danger" })
                <div class="form-group">
                    <label>Write discriptin</label>
                    <div>
                        <input type="text" id="discriptin" name="Discriptin" />
                    </div>
                </div>
                <div class="form-group">
                    <label>Pictures </label>
                    <div class="col-md-10">
                        <input type="file" id="image" name="Image" />
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-offset-1 col-md-10">
                        <input type="submit" class="btn btn-default" value="Upload picture" />
                    </div>
                </div>
            }
        }

        <table id="TablePictures">
            @if (Model.PostsWithPictures.Count > 3)
            {
                for (int i = 0; i < Model.PostsWithPictures.Count; i += 3)
                {
                    <tr>
                        @for (int j = i; j < i + 3; j++)
                        {
                            if (j < Model.PostsWithPictures.Count)
                            {
                                <td>
                                    <p>@Model.PostsWithPictures[j].Disctription</p>
                                    <p>@Model.PostsWithPictures[j].DateOnPost</p>
                                    <img src="@Model.PostsWithPictures[j].ImagePost" alt="" style="max-height:300px;max-width:300px" />
                                    @if (!@Model.PostsWithPictures[j].IsProfilePicture)
                                    {
                                        <button id="MekaProfilePicture" name="@Model.PostsWithPictures[j].PostId">Make profile picture</button>
                                    }
                                </td>
                            }
                        }
                    </tr>
                }
            }
            else
            {
                <tr>
                    @foreach (var picture in Model.PostsWithPictures)
                    {
                        <td>
                            <p>@picture.Disctription</p>
                            <p>@picture.DateOnPost</p>
                            <img src="@picture.ImagePost" alt="" style="max-height:300px;max-width:300px" />
                            @if (!picture.IsProfilePicture)
                            {
                                <button id="MekaProfilePicture" name="@picture.PostId">Make profile picture</button>
                            }
                        </td>
                    }
                </tr>
            }
        </table>
    </div>
   
    <script>
        $("#TablePictures").on("click", "#MekaProfilePicture", function (e) {

            var postId = $(this).attr('name');

            $.ajax({
                url: "/DetaialUser/ChangeProfilePicture",
                type: "POST",
                data: JSON.stringify({ PostId: postId.toString() }),
                dataType: "json",
                traditional: true,
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    if (data.status == "Success") {
                        window.location.href = '@Url.Action("Pictures/" + User.Identity.Name, "DetaialUser")';
                    }
                }
            });

        });
    </script>

</body>
</html>
