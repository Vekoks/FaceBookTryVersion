@{
    ViewBag.Title = "Home Page";
}

@model FaceBookClient.Models.HomeIndexViewModel

<div class="jumbotron">
    <h1>ASP.NET</h1>
    <p class="lead">ASP.NET is a free web framework for building great Web sites and Web applications using HTML, CSS and JavaScript.</p>
    <p><a href="http://asp.net" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>
</div>

@*<div id="AskFriendList">
        <p>Invitations from Friend: @Model.CountAskForFriend</p>
        @foreach (var ask in Model.AllAskForFriend)
        {
            <div>
                <p>@ask.Username</p>
                <p>@Html.ActionLink("Accept invitation", "ConferFriend/" + ask.Username + "/accept", "Home", new { @class = "btn btn-info" })</p>
                <p>@Html.ActionLink("Detele invitation", "ConferFriend/" + ask.Username + "/delete", "Home", new { @class = "btn btn-info" })</p>
            </div>
        }
    </div>*@

<div id="PostList"></div>

<div id="AskFriendList"></div>


<div class="row">
    <div id="Chat"></div>
    <div style="float: right; right: 5%">
        <h2>Users:</h2>
        <ul id="UsersList" class="list-group" style="border: 2px solid; float:right"></ul>
    </div>

</div>

<h3>Messages: </h3>
@{
    foreach (var message in Model.Messages)
    {
        <div>
            <p style="float:left">@message.UserName:</p>
            <p> @message.Letter</p>
        </div>
    }
}


<script src="~/Scripts/ScriptForChat.js"></script>
<script src="~/Scripts/ScriptForUserInfo.js"></script>
<script src="~/Scripts/ScriptForAskFriend.js"></script>

<script>

    $(function () {

        // Proxy created on the fly
        var job = $.connection.postHub;

        // Declare a function on the job hub so the server can invoke it
        job.client.displayAllPost = function () {
            getDataForAllPost();
        };

        // Start the connection
        $.connection.hub.start();
        getDataForAllPost();
    });


    function getDataForAllPost() {
        var $tbl = $('#PostList');

        $.ajax({
            url: 'GetAllPostFromUsers',
            type: 'GET',
            datatype: 'json',
            success: function (data) {
                if (data.length > 0) {
                    $tbl.empty();
                    var rows = [];
                    rows.push(' <p>Post</p>');
                    for (var i = 0; i < data.length; i++) {
                        rows.push(' <div>');
                        rows.push('  <a id="UserName" href="/DetaialUser/Details/' + data[i].UserName + '">' + data[i].UserName + '</a>');
                        rows.push('  <p>Post:' + data[i].DiscriptionPost + '</p>');
                        rows.push(' </div>');
                    }
                    
                    $tbl.append(rows.join(''));
                }
            }
        });
    }
</script>